generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum StatusComanda {
  ABERTA
  FECHADA
  CANCELADA
  PENDENTE
}

enum PapelUsuario {
  ADMIN
  FUNCIONARIO
  GARCOM
  COZINHA
}

model Empresa {
  id        String    @id @default(uuid())
  nome      String
  cnpj      String?   @unique
  telefone  String?
  email     String?

  usuarios   Usuario[]
  categorias Categoria[]
  produtos   Produto[]
  comandas   Comanda[]

  criadoEm   DateTime @default(now())
  atualizadoEm DateTime @updatedAt

  @@map("empresas")
}

model Usuario {
  id        String       @id @default(uuid())
  nome      String
  email     String       @unique
  senha     String
  papel     PapelUsuario @default(FUNCIONARIO)

  empresaId String
  empresa   Empresa      @relation(fields: [empresaId], references: [id])

  comandas  Comanda[]    @relation("ComandasDoUsuario")

  criadoEm   DateTime @default(now())
  atualizadoEm DateTime @updatedAt

  @@map("usuarios")
}

model Categoria {
  id        Int       @id @default(autoincrement())
  nome      String
  descricao String?

  empresaId String
  empresa   Empresa  @relation(fields: [empresaId], references: [id])

  produtos  Produto[] @relation("CategoriaProdutos")

  @@unique([empresaId, nome])

  @@map("categorias")
}

model Produto { 
  id          String    @id @default(uuid())
  nome        String
  descricao   String?
  preco       Decimal   @db.Decimal(10, 2)
  estoque     Int       @default(0)
  ativo       Boolean   @default(true)
  imagem      String?

  empresaId   String
  empresa     Empresa   @relation(fields: [empresaId], references: [id])

  categoriaId Int
  categoria   Categoria @relation("CategoriaProdutos", fields: [categoriaId], references: [id])

  itensPedidos PedidoItem[]

  tipo_item   String?   @default("REFEICAO_FIXO")

  criadoEm    DateTime @default(now())
  atualizadoEm DateTime @updatedAt

  @@map("produtos")
}

model Comanda {
  id          String         @id @default(uuid())
  numero      String         // ex: "123" (o numero da comanda física)
  data        DateTime       @default(now())
  status      StatusComanda  @default(ABERTA)

  empresaId   String
  empresa     Empresa        @relation(fields: [empresaId], references: [id])

  // opcional: usuário responsável pela comanda (garçom)
  usuarioId   String?
  usuario     Usuario?       @relation("ComandasDoUsuario", fields: [usuarioId], references: [id])

  pedidos     PedidoItem[]

  criadoEm    DateTime @default(now())
  atualizadoEm DateTime @updatedAt

  @@map("comandas")
}

model PedidoItem {
  id              String   @id @default(uuid())

  comandaId       String
  comanda         Comanda  @relation(fields: [comandaId], references: [id])

  produtoId       String
  produto         Produto  @relation(fields: [produtoId], references: [id])

  quantidade      Decimal? @db.Decimal(10, 2)
  precoUnitario   Decimal? @db.Decimal(10, 2)
  subtotal        Decimal? @db.Decimal(10, 2)
  observacoes     String?

  criadoEm        DateTime @default(now())
  atualizadoEm    DateTime @updatedAt

  @@map("pedido_itens")
}
